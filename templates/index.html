<!--
Copyright 2017 DevX Labs
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
{% load static %}
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.marcoguglie.it/Codepen/AnimatedHeaderBg/demo-1/js/EasePack.min.js"></script>
    <script src="https://www.marcoguglie.it/Codepen/AnimatedHeaderBg/demo-1/js/rAF.js"></script>
    <script src="https://www.marcoguglie.it/Codepen/AnimatedHeaderBg/demo-1/js/TweenLite.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Raleway:200,400,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
<style>
::-webkit-scrollbar {
    width: 0px;
    background: transparent; /* make scrollbar transparent */
}
/* Header */
input:focus {
    outline:none;
}
button:focus {
    outline:none;
}
::placeholder { /* Most modern browsers support this now. */
   color:    #e5e5e5;
}
body{
    position: relative;
    width: 100%;
    background: #333;
    overflow: hidden;
    background-size: cover;
    background-position: center center;
}

body {
    background-image: url('{%static 'img/sky.jpg' %}');
}

.main-title {
    position: absolute;
    margin: 0;
    padding: 0;
    color: #f9f1e9;
    text-align: center;
    top: 10%;
    left: 50%;
    -webkit-transform: translate3d(-50%,-50%,0);
    transform: translate3d(-50%,-50%,0);
}

.main-title {
    text-transform: uppercase;
}

.main-title .thin {
    font-weight: 200;
}

@media only screen and (max-width : 768px) {
    .main-title {
        font-size: 3em;
    }
}
li {
    list-style-type: none;
}
.signin {
    background-color:rgba(229,229,229,0) !important;
    color:#e5e5e5;
    width:40%;
}
.signin:hover {
    background-color: white !important;
}
.help {
    background-color:rgba(229,229,229,0) !important;
    color:#e5e5e5;
    margin-left:2%;
    width:52%;
}
.help:hover {
    background-color: #ed5588 !important;
    border:1px solid #ed5588;
    color:white;
} 
.popup-box {
    background-color: #ffffff;
    bottom: 0%;
    margin-right:-3.2%;
    display: none;
    height: 385px;
    position: fixed;
    right: 70px;
    width: 300px;
    font-family: 'Open Sans', sans-serif;
}
.round.hollow {
    margin: 40px 0 0;
}
.round.hollow a {
    text-decoration: none;
    background-color: #fff;
    clear: both;
    color: #7b7b7b;
    display: inline-table;
    font-size: 20px;
    padding: 10px 10px;
    width: 110%;
    font-family: 'Open Sans', sans-serif;
    margin-left:-10%;
}
#qnimate {
    transition:height 0.5s ease;
}
.popup-box-on {
    display: block !important;
}
.popup-box .popup-head {
    background-color: #fff;
    clear: both;
    color: #7b7b7b;
    display: inline-table;
    font-size: 20px;
    padding: 7px 10px;
    width: 100%;
    font-family: 'Open Sans', sans-serif;
}
.bg_none i {
    border: 1px solid #4ca64c;
    border-radius: 25px;
    color: #4ca64c;
    font-size: 17px;
    height: 33px;
    line-height: 30px;
    width: 33px;
}
.bg_none:hover i {
    border: 1px solid #000;
    border-radius: 25px;
    color: #000;
    font-size: 17px;
    height: 33px;
    line-height: 30px;
    width: 33px;
}
.bg_none {
    background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
    border: medium none;
}

.popup-box .popup-messages {
    background-image: url('{% static 'img/chat_bg1.jpg' %}');
    border:none;
    height: 275px;
    overflow: auto;
}
.popup-head-right .btn-group {
    display: inline-flex;
    margin: 0 8px 0 0;
    vertical-align: top !important;
}
.chat-header-button {
    background: transparent none repeat scroll 0 0;
    border: 1px solid #636364;
    border-radius: 50%;
    font-size: 14px;
    height: 30px;
    width: 30px;
}

.direct-chat-text {
    background: #4ca64c none repeat scroll 0 0;
    border: 1px solid #4ca64c;
    border-radius: 5px;
    color: #fff;
    margin: 5px 10px 0 50px;
    padding: 5px 10px;
    position: relative;
} 
.left{
    background: #d2d6de none repeat scroll 0 0;
    border: 1px solid #d2d6de;
    border-radius: 5px;
    color: #444;
    margin: 5px 100px 5px -28px;
    padding: 5px 10px;
    position: relative; 
}
.send_btn {
    margin-top: -12%;
}
</style>
</head>
<div style="position:relative;" id="large-header">
    <canvas style="position:absolute;z-index:-1000;" id="demo-canvas"></canvas>
<h1 style="z-index:1000;" class="main-title"><span style="vertical-align:11px;">Feedback</span> <span style="font-size:2em;color:#4ca64c;" class="thin">360</span></h1>
<div class="col-md-4 aitsloginwthree w3layouts agileits" style="margin-top:15%;left:33%;padding-top:10%;padding-bottom:1%;background-color: rgba(250,250,250, 0.3);z-index:1000;border-radius:5%;">
    <div style="left:0;top:3%;position: absolute;" class="col-md-4">
    <img style="padding:10%;" width="100" src="https://bmsit.ac.in/assets/logo-167a1e45069e8f279b09630a9bff0d35e6cba7f016a24651e39a40dc422e9dc1.png">
    </div>
    <div style="top:3%;left:27%;position:absolute;padding:2%;" class="col-md-8">
        <h3 style="color:#e5e5e5;text-align: center;">BMS INSTITUTE OF TECHNOLOGY</h3>
    </div>
    <form style="margin-left:3%;margin-top:3%;" action="#" method="post" onsubmit="return checkForm(this);">{% csrf_token %}
        <input style="color:white;background:none;border:none;border-bottom:1px solid #e5e5e5;margin-bottom:2%;width:93%;font-size:120%;" type="text" name="usn1" id="usn" placeholder="Enter Username/USN">
        <div style="margin-top:2%;" class="send-button wthree agileits">
            <input type="submit"  data-toggle="tooltip" data-placement="top" title="Clear" name="myButton" class="btn btn-default btn-lg signin" value="Sign In">
            <a class="btn btn-default btn-lg help" data-toggle="modal" data-target="#cbModal">Need Help?</a>
        </div>
    </form>
</div>
<div style="z-index:100;" class="popup-box chat-popup" id="qnimate">
    <div class="popup-head">
        <div class="popup-head-left pull-left">Feedback Assistance</div>
        <div class="popup-head-right pull-right">
            <div class="btn-group">
                <button id="clear" class="chat-header-button" title="Clear chat">
                    <i class="fa fa-eraser"></i> </button>
                    </div>
                <button title="Close" data-widget="remove" id="removeClass" class="chat-header-button pull-right" type="button"><i class="fa fa-times"></i></button>
        </div>
    </div>
            <div class="popup-messages">
                <div class="direct-chat-msg">
                <ul class="messages">
                </ul>
                  <!-- /.direct-chat-text -->
                </div>
            </div>
            <div class="popup-messages-footer">
                <input style="border-radius:10px;border:1px solid #4ca64c;margin-left:2%;padding:2%;z-index:100;width:80%;margin-top: 5%;" id="status_message" placeholder="Type a message..." name="message">
                <div class="btn-footer">
                    <button class="bg_none pull-right send_btn"><i class="fa fa-paper-plane"></i></button>
                </div>
            </div>
    </div>
</div>
<div class="modal fade" id="cbModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    </div>
    <div class="modal-body">
    <iframe src="https://goo.gl/forms/tSlNVC31lu8pQ5013" frameborder="0" onmousewheel="" width="100%" height="1072" style="background: transparent;"></iframe>
    </div>
    </div>
    </div>
    </div>
<footer style="position:fixed;bottom:0;" class="col-md-12 page-footer fixed-bottom center-on-small-only footer-main">
    <div class="col-md-6 container-fluid">
        <h5><strong><center style="margin-top:5%;float:left;"><span style="color:white;">A product by</span><a style="color:#ffc05b;" href="https://infoniumlabs.site" target="blank"> DevX<img id="logo" src="https://bmsit.ac.in/devx.png" style="width:50px; vertical-align: middle;"></a></center></strong></h5>
    </div>
    <div style="width:20%;float:right;" class="col-md-6 container text-center">
        <div class="round hollow text-center">
            <a href="#" id="addClass"> CHAT WITH US </a>
        </div>
    </div>  
</footer>
<script>
    $(document).ready(function(){
        $("#usn").keyup(function(){
            $("#usn").val($("#usn").val().toUpperCase());
        });
    });
</script>
<script>
    (function() {

    var width, height, largeHeader, canvas, ctx, points, target, animateHeader = true;

    // Main
    initHeader();
    initAnimation();
    addListeners();

    function initHeader() {
        width = window.innerWidth;
        height = window.innerHeight;
        target = {x: width/2, y: height/2};

        largeHeader = document.getElementById('large-header');
        largeHeader.style.height = height+'px';

        canvas = document.getElementById('demo-canvas');
        canvas.width = width;
        canvas.height = height;
        ctx = canvas.getContext('2d');

        // create points
        points = [];
        for(var x = 0; x < width; x = x + width/20) {
            for(var y = 0; y < height; y = y + height/20) {
                var px = x + Math.random()*width/20;
                var py = y + Math.random()*height/20;
                var p = {x: px, originX: px, y: py, originY: py };
                points.push(p);
            }
        }

        // for each point find the 5 closest points
        for(var i = 0; i < points.length; i++) {
            var closest = [];
            var p1 = points[i];
            for(var j = 0; j < points.length; j++) {
                var p2 = points[j]
                if(!(p1 == p2)) {
                    var placed = false;
                    for(var k = 0; k < 5; k++) {
                        if(!placed) {
                            if(closest[k] == undefined) {
                                closest[k] = p2;
                                placed = true;
                            }
                        }
                    }

                    for(var k = 0; k < 5; k++) {
                        if(!placed) {
                            if(getDistance(p1, p2) < getDistance(p1, closest[k])) {
                                closest[k] = p2;
                                placed = true;
                            }
                        }
                    }
                }
            }
            p1.closest = closest;
        }

        // assign a circle to each point
        for(var i in points) {
            var c = new Circle(points[i], 2+Math.random()*2, 'rgba(255,255,255,0.3)');
            points[i].circle = c;
        }
    }

    // Event handling
    function addListeners() {
        if(!('ontouchstart' in window)) {
            window.addEventListener('mousemove', mouseMove);
        }
        window.addEventListener('scroll', scrollCheck);
        window.addEventListener('resize', resize);
    }

    function mouseMove(e) {
        var posx = posy = 0;
        if (e.pageX || e.pageY) {
            posx = e.pageX;
            posy = e.pageY;
        }
        else if (e.clientX || e.clientY)    {
            posx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
            posy = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
        }
        target.x = posx;
        target.y = posy;
    }

    function scrollCheck() {
        if(document.body.scrollTop > height) animateHeader = false;
        else animateHeader = true;
    }

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        largeHeader.style.height = height+'px';
        canvas.width = width;
        canvas.height = height;
    }

    // animation
    function initAnimation() {
        animate();
        for(var i in points) {
            shiftPoint(points[i]);
        }
    }

    function animate() {
        if(animateHeader) {
            ctx.clearRect(0,0,width,height);
            for(var i in points) {
                // detect points in range
                if(Math.abs(getDistance(target, points[i])) < 4000) {
                    points[i].active = 0.3;
                    points[i].circle.active = 0.6;
                } else if(Math.abs(getDistance(target, points[i])) < 20000) {
                    points[i].active = 0.1;
                    points[i].circle.active = 0.3;
                } else if(Math.abs(getDistance(target, points[i])) < 40000) {
                    points[i].active = 0.02;
                    points[i].circle.active = 0.1;
                } else {
                    points[i].active = 0;
                    points[i].circle.active = 0;
                }

                drawLines(points[i]);
                points[i].circle.draw();
            }
        }
        requestAnimationFrame(animate);
    }

    function shiftPoint(p) {
        TweenLite.to(p, 1+1*Math.random(), {x:p.originX-50+Math.random()*100,
            y: p.originY-50+Math.random()*100, ease:Circ.easeInOut,
            onComplete: function() {
                shiftPoint(p);
            }});
    }

    // Canvas manipulation
    function drawLines(p) {
        if(!p.active) return;
        for(var i in p.closest) {
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(p.closest[i].x, p.closest[i].y);
            ctx.strokeStyle = 'rgba(156,217,249,'+ p.active+')';
            ctx.stroke();
        }
    }

    function Circle(pos,rad,color) {
        var _this = this;

        // constructor
        (function() {
            _this.pos = pos || null;
            _this.radius = rad || null;
            _this.color = color || null;
        })();

        this.draw = function() {
            if(!_this.active) return;
            ctx.beginPath();
            ctx.arc(_this.pos.x, _this.pos.y, _this.radius, 0, 2 * Math.PI, false);
            ctx.fillStyle = 'rgba(156,217,249,'+ _this.active+')';
            ctx.fill();
        };
    }

    // Util
    function getDistance(p1, p2) {
        return Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2);
    }
    
})();
</script>
<script>
    $(function(){
        $("#addClass").click(function () {
            $('.text-center').css('display', 'none');
            $('#qnimate').addClass('popup-box-on');
            $('#status_message').focus();
        });
        $("#removeClass").click(function () {
        $('#qnimate').removeClass('popup-box-on');
        $('.text-center').css('display', 'block');
        });
    })
</script>
<script>
    !function(a){if("function"==typeof define&&define.amd)define(a);else if("object"==typeof exports)module.exports=a();else{var b=window.Cookies,c=window.Cookies=a(window.jQuery);c.noConflict=function(){return window.Cookies=b,c}}}(function(){function a(){for(var a=0,b={};a<arguments.length;a++){var c=arguments[a];for(var d in c)b[d]=c[d]}return b}function b(c){function d(b,e,f){var g;if(arguments.length>1){if(f=a({path:"/"},d.defaults,f),"number"==typeof f.expires){var h=new Date;h.setMilliseconds(h.getMilliseconds()+864e5*f.expires),f.expires=h}try{g=JSON.stringify(e),/^[\{\[]/.test(g)&&(e=g)}catch(i){}return e=encodeURIComponent(String(e)),e=e.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),b=encodeURIComponent(String(b)),b=b.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),b=b.replace(/[\(\)]/g,escape),document.cookie=[b,"=",e,f.expires&&"; expires="+f.expires.toUTCString(),f.path&&"; path="+f.path,f.domain&&"; domain="+f.domain,f.secure?"; secure":""].join("")}b||(g={});for(var j=document.cookie?document.cookie.split("; "):[],k=/(%[0-9A-Z]{2})+/g,l=0;l<j.length;l++){var m=j[l].split("="),n=m[0].replace(k,decodeURIComponent),o=m.slice(1).join("=");'"'===o.charAt(0)&&(o=o.slice(1,-1));try{if(o=c&&c(o,n)||o.replace(k,decodeURIComponent),this.json)try{o=JSON.parse(o)}catch(i){}if(b===n){g=o;break}b||(g[n]=o)}catch(i){}}return g}return d.get=d.set=d,d.getJSON=function(){return d.apply({json:!0},[].slice.call(arguments))},d.defaults={},d.remove=function(b,c){d(b,"",a(c,{expires:-1}))},d.withConverter=b,d}return b()});
    </script>
<script>
    var chatterbotUrl = '{% url "chatterbot:chatterbot" %}';
    var csrftoken = Cookies.get('csrftoken');
      function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
      }
      $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
        }
      });
    String.prototype.format = function() {
        a = this;
        for (k in arguments) {
            a = a.replace("{" + k + "}", arguments[k])
        }
        return a
    }
    String.prototype.newLine = function() {
        a = this;
        a = a.replace(new RegExp('\r?\n','g'), '<br />');
        return a
    }
    $(function() {
        $('#status_message').keypress(function(e) {
            if(e.which == 13) {
                $('.popup-messages').animate({
                    scrollTop: $(".popup-messages-footer").offset().top
                }, 100);
                var message = $('#status_message').val();
                $('.messages').append(`<li><div class="direct-chat-text">{0}</div></li>`.format(message));
                $('#status_message').val('');
                var csrfmiddlewaretoken = $('input[name=csrfmiddlewaretoken]').val();
            var $submit = $.ajax({
              type: 'POST',
              url: chatterbotUrl,
              data: JSON.stringify({'text':message}),
                contentType: 'application/json'
            });
            $submit.done(function(statement) {
                $('.popup-messages').animate({
                    scrollTop: $(".popup-messages-footer").offset().top
                }, 100);
                $('.messages').append(`<li><div class="direct-chat-text left">{0}</div></li>`.format(statement.text).newLine());
                
                $('#status_message').val('');
                // Scroll to the bottom of the chat interface
                //$chatlog[0].scrollTop = $chatlog[0].scrollHeight;
            });
            }
        });
    })
    $(function() {
        $('.send_btn').click(function() {
            $('.popup-messages').animate({
                scrollTop: $(".popup-messages-footer").offset().top
            }, 100);
            var message = $('#status_message').val();
            $('ul').append(`<li><div class="direct-chat-text">{0}</div></li>`.format(message));
            $('#status_message').val('');
            var csrfmiddlewaretoken = $('input[name=csrfmiddlewaretoken]').val();
            var $submit = $.ajax({
              type: 'POST',
              url: chatterbotUrl,
              data: JSON.stringify({'text':message}),
                contentType: 'application/json'
            });
            $submit.done(function(statement) {
                $('.popup-messages').animate({
                    scrollTop: $(".popup-messages-footer").offset().top
                }, 100);
                $('ul').append(`<li><div class="direct-chat-text left">{0}</div></li>`.format(statement.text).newLine());
                // Clear the input field
                $('#status_message').val('');
                // Scroll to the bottom of the chat interface
                //$chatlog[0].scrollTop = $chatlog[0].scrollHeight;
            });
        });
    })
    $(function() {
        $('#clear').click(function() {
            $('.messages').empty();
        })
    })
</script>